<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Up</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">

    <?php
include("conexao.php");
if ($_SERVER["REQUEST_METHOD"] == "GET"){
  $endereco = $_GET["endereco"];
  $sql =<<<EOF
  select * from rota;
EOF;
  $ret = pg_query($db, $sql);
  $amigo = pg_last_error();
  // echo $amigo;
  if(!$ret) {
     http_response_code(501);
  } else {
     http_response_code(200);
     $response["dados"] = array();
    while($row = pg_fetch_row($ret)) {
      $rota = array();
      $rotaid = $row[0];
      $contrato = $row[1];
      $edificio = $row[2];
      $ordem = $row[3];
      $endereco = $row[4];
      $unidade = $row[5];
      array_push($response["dados"], $rota);
    }

    echo json_encode($response);
    setcookie($rotaid, $contrato, $edificio, $ordem, $endereco, $unidade);

  }
}

?>


    <script>
        var setarInfo = function(){
            console.log("entrei no setarInfo");
            localStorage.setItem("endereco",document.getElementById("endereco").value);
            pegarRota();
        }


        function pegarRota(){
            let endereco = localStorage.getItem("endereco");
            console.log(endereco);
            var settings = {
                "url": "https://sistemaelevadores.herokuapp.com/buscarRota.php?endereco=" + endereco,
                "method": "GET",
                "timeout": 0,
                "processData": false,
                "mimeType": "multipart/form-data",
                "contentType": false,
            };
            var x = document.cookie;
            console.log(x);
           

            //
            // $.ajax(settings).done(
            //     function (response) {
            //     console.log(response);
            //     var jx = JSON.parse(response);
            //     console.log(jx);
            //
            // });
        }


    </script>



</head>
<body>
<form action="buscarRota.php">
    <div class="centralizar">
        <div class="flex-semPadding"><label for="endereco"><p><b>Endereço</b></p></label></div>
        <div class="flex-semPadding"><input type="text" placeholder="Digite o endereço" name="endereco" id="endereco" required></div>
    </div>
    <button type="submit" onclick="setarInfo()">Procurar</button>

</form>
</body>
</html>
